<!DOCTYPE html>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://cdn.jsdelivr.net/npm/skapi-js@latest/dist/skapi.js"></script>
<script src="../service.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/modern-init-css@latest/init.css">
<link rel="stylesheet" href="../custom.css">

<main id="main_page">
    <form action='../index.html' onsubmit="
        disableForm(this, true);
        skapi.resetPassword(event).then(()=>alert('Password has been reset.')).catch(err=>alert(err.message)).finally(()=>disableForm(this, false));
    ">
        <div class="spaceBetween">
            <h2>Reset Password</h2>
            <a href="../index.html">Back</a>
        </div>
        <hr>
        <p>Enter the 6 digits verification code you may have received in your email and set new password below.</p>
        <input type="email" name="email" placeholder="E-Mail" required hidden>
        <script>
            let email = location.hash.slice(1);
            document.querySelector('input[name=email]').value = email;
        </script>
        <table>
            <tr>
                <td>Code</td>
                <td>
                    <input type="text" name="code" placeholder="6 digits code" required>
                </td>
            </tr>
            <tr>
                <td>New Password</td>
                <td>
                    <input type="password" name="new_password" placeholder="New Password" required>
                </td>
            </tr>
            <tr>
                <td></td>
                <td class="alignRight">
                    <input type="submit" value="Change Password">
                </td>
            </tr>
        </table>
        <br>
        <br>
        If you have not received the code,
        <br>
        please check your spam folder.
        <br>
        <br>
        <span>
            Or click <ins class='clickable' onclick="
                let userConfirm = confirm(`We will send a verification code to ${email}. Continue?`);
                if (userConfirm) {
                    skapi.forgotPassword({email}).then(()=>this.parentElement.innerHTML = 'Verification code has been sent.').catch(err=>alert(err.message));
                }
            ">HERE</ins> to resend.
        </span>
        <br>
        <p><strong>Note: </strong>If your account's email address is not verified, you will not be able to reset your
            password.</p>
    </form>
</main>